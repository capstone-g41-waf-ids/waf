#
SecDefaultAction "phase:1,log,auditlog,deny,status:403"


## Special Element Injections ------------------------------------------------------------------------------------------
## ellen note - this seems super general , probably covered by other items?
#
##Command and OS Command Injections ------------------------------------------------------------------------------------
##just check if any special chars are in packet url or body text
##https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/12-Testing_for_Command_Injection
##special_chars = ['!', '\"', '#', '$', '%', '&', '(', ')', '*', '+', ',', '.', '/', ':', ';', '<', '=', '>', '?', '@', '[', '\\', ']', '^', '`', '{', '|', '}', '~', '–', '‘']
#
##XSS Attempts ---------------------------------------------------------------------------------------------------------
#
#reflected xss
##xss = ["<", ">", "javascript", ".js", "<script", "script>", "alert", "bot", "\.", "\\", "\/", "//", onerror, onload, on<anything>]
#
SecRule REQUEST_URI|ARGS|REQUEST_BODY "@rx (?i)((<|&lt|%3C)*script(>|&gt;|%3E)*)" "id:100001,phase:1,log,auditlog,deny,status:403,msg:'XSS'"
#xss = "(?i)(<|&lt|%3C)*script(>|&gt;|%3E)*"
## < &lt; > &gt;
#
#&  "&amp;"
#<  "&lt;"
#>  "&gt;"
#" "&quot;"
#'  "&#039;"
#\n "<br>"
#
#
##stored xss
#
##SQL Injection
## stored in database
##sqli = "(?i)"
##sqli = ["insert", "select", "union", "alter", "create", "delete", "drop", "execute", "exec", "merge", "update", "*", "<", ">", "1=1", "'1'", "--", "1'1", " = ", ";" ]
## for < > need to filter out expected tags
#
##XML and CRLF Injections
##xml = ""
#
## Status Code Injections
##status_code_injections = ""
#
## FILE INCLUSION
#
#PATH TRAVERSAL
#
#What to check for:
#- IN REQUEST URL
#    - \..\
#    - \..\ but encoded
#
SecRule REQUEST_URI|ARGS|REQUEST_BODY|REQUEST_URI_RAW "@rx (?i)((((\.|%(25)?2e)+(\\|%(25)?5C)*(\\?\/|%((25)?2f|c0|af))+)+)|(\.|%(25)?2e){2,}|\\+)" "id:100002,phase:1,log,auditlog,deny,status:403,msg:'Traversal'"
#traversal = "(?i)((((\.|%(25)?2e)+(\\|%(25)?5C)*(\\?\/|%((25)?2f|c0|af))+)+)|(\.|%(25)?2e){2,}|\\+)"



##LOCAL FILE INCLUSION
##
##What to check for:
##- IN REQUEST URL
##    - ["<not https or http>:", "file=", "php:", "zip:", "data:", "expect:" "<directory traversal>", "%00"]
#
SecRule REQUEST_URI "@rx (?i)((.+((http|php|zip|data|expect):))|(%00)+)" "id:100003,phase:1,log,auditlog,deny,status:403,msg:'LFI'"
##lfi = "(?i)((.+((http|php|zip|data|expect):))|(%00)+)"
##include list of internal/restricted files?


#PHP FILE INCLUSIONS
#
#What to check for:
#- IN REQUEST URL
#   - (.php)
#   - include(), require()
#
SecRule ARGS "@rx (?i)((\.php)+)" "id:100004,phase:1,log,auditlog,deny,status:403,msg:'PHP Inclusion'"
#php_lfi = "(?i)((\.php)+)"


#REMOTE FILE INCLUSION
#
#What to check for:
#- IN REQUEST URL
#   - URL (http(s), ftp(s), file)
#   - IP - "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}"
#   - Include functions (include(s), include_once, etc)
#
SecRule REQUEST_URI|ARGS|REQUEST_BODY "@rx (?i)(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})" "id:100005,phase:1,log,auditlog,deny,status:403,msg:'RFI'"


#RESOURCE INJECTION
## resource_injection = ""
# http://www.vulnerable.com/open.aspx?filename=\\192.168.1.2\test.txt

#
## HTTP Response splitting
## http_response_splitting = ""
#
## Xpath and xquery injections
## xpath_xquery_injection = ""
#
## scripted http headers and expression language injections
## header = "<script>"
#
## encoding injections
#
## http request smuggling
#

# SERVER-SIDE REQUEST FORGERY (SSRF)
# wrappers
# /  &frasl;  %2F
# : &#58;  %3A

SecRule REQUEST_URI "@rx (?i)((dict|expect|fd|files*|gopher|https*|imap|jar|proto-schema|ldap|mailto|netdoc|ogg|pop3|[st]*[mf]tp|ssh2*|telnet)(:)(/)*)" "id:100006,phase:1,log,auditlog,deny,status:403,msg:'SSRF wrapper'"

# localhost bypass
SecRule REQUEST_URI_RAW|REQUEST_URI|ARGS "@rx (?i)((.)*(\/\/.+[\/](\#|\@|\?|\\)+)|(\.|\@|\\|:|#|\?|%|\/)*((0x[\dA-F]{8})|\d{10}|(\[(((0{1,4}|1|ffff)*:*)){1,7}\]*)|(((127|[0-3])\.*){1,3}(127|[0-3])*)+(:(22|25|80|443|3128))*(\.|\@|\\|:|#|\?|%|\/)*))" "id:100007,phase:1,log,auditlog,deny,status:403,msg:'SSRF Localhost Bypass'"
SecRule REQUEST_URI "@rx (?i)(((localho)*st)+[^a-z])" "id:100008,phase:1,log,auditlog,deny,status:403,msg:'SSRF Localhost Bypass'"
