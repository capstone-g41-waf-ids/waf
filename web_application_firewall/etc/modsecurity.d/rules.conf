#
SecDefaultAction "phase:1,log,auditlog,deny,status:403"

##XSS Attempts ---------------------------------------------------------------------------------------------------------
#
#reflected xss
##xss = ["<", ">", "javascript", ".js", "<script", "script>", "alert", "bot", "\.", "\\", "\/", "//", onerror, onload, on<anything>]
#
SecRule REQUEST_URI|ARGS|REQUEST_BODY "@rx (?i)((<|&lt|%3C)*script(>|&gt;|%3E)*)" "id:100001,phase:1,log,auditlog,deny,status:403,msg:'XSS'"



##SQL Injection---------------------------------------------------------------------------------------------------------
## stored in database
##sqli = ["insert", "select", "union", "alter", "create", "delete", "drop", "execute", "exec", "merge", "update", "*", "<", ">", "1=1", "'1'", "--", "1'1", " = ", ";" ]
## for < > need to filter out expected tags
#
SecRule REQUEST_URI|ARGS|REQUEST_BODY "@rx (?i)(([\"\']|%22|%27){0,2}[+\s]*\)*[+\s]*(or)[+\s]*\(*[+\s]*(([\"\']|%22|%27){0,2}1*([\"\']|%22|%27){0,2})[+\s]*(=|%3D)[+\s]*([\"\']|%22|%27){0,2}1*)" "id:100030,phase:2,log,auditlog,deny,status:403,msg:'SQLI True Statements'"
SecRule REQUEST_URI|ARGS|REQUEST_BODY "@rx (?i)(((\/|%2F)(\*|%2A).*(\*|%2A)(\/|%2F))|((\/|%2F)(\*|%2A))|((\*|%2A)(\/|%2F))|(\-|%96){2})" "id:100031,phase:2,log,auditlog,deny,status:403,msg:'SQLI Comments'"
SecRule REQUEST_URI|ARGS|REQUEST_BODY "@rx (?i)((\;|%3B).*(drop|selec|union|alter|create|delete|execute|exec|merge|update))" "id:100032,phase:2,log,auditlog,deny,status:403,msg:'SQLI Stacked Queries'"
SecRule REQUEST_URI|ARGS|REQUEST_BODY "@rx (?i)((?i)((admin)([\"\']|%22|%27)*\)*[+\s]*|([\"\']|%22|%27)*\)*[+\s]*(or)[+\s]*\(*([\"\']|%22|%27){0,2}1*([\"\']|%22|%27){0,2}[+\s]*(=|%3D)[+\s]*([\"\']|%22|%27){0,2}1*)(((\/|%2F)(\*|%2A).*(\*|%2A)(\/|%2F))|((\/|%2F)(\*|%2A))|((\*|%2A)(\/|%2F))|(\-|%96){2}|#))" "id:100033,phase:2,log,auditlog,deny,status:403,msg:'SQLI Login Bypass'"



## FILE INCLUSION-------------------------------------------------------------------------------------------------------
#
#PATH TRAVERSAL
#
#What to check for:
#- IN REQUEST URL
#    - \..\
#    - \..\ but encoded
#
SecRule REQUEST_URI|ARGS|REQUEST_BODY|REQUEST_URI_RAW "@rx (?i)((((\.|%(25)?2e)+(\\|%(25)?5C)*(\\?\/|%((25)?2f|c0|af))+)+)|(\.|%(25)?2e){2,}|\\+)" "id:100002,phase:1,log,auditlog,deny,status:403,msg:'Traversal'"



##LOCAL FILE INCLUSION--------------------------------------------------------------------------------------------------
##
##What to check for:
##- IN REQUEST URL
##    - ["<not https or http>:", "file=", "php:", "zip:", "data:", "expect:" "<directory traversal>", "%00"]
#
SecRule REQUEST_URI "@rx (?i)((.+((http|php|zip|data|expect):))|(%00)+)" "id:100003,phase:1,log,auditlog,deny,status:403,msg:'LFI'"



#PHP FILE INCLUSIONS----------------------------------------------------------------------------------------------------
#
#What to check for:
#- IN REQUEST URL
#   - (.php)
#   - include(), require()
#
SecRule REQUEST_URI|ARGS "@rx (?i)(((\/.*\/.*)+\.php)+)" "id:100004,phase:1,log,auditlog,deny,status:403,msg:'PHP Inclusion'"



#REMOTE FILE INCLUSION--------------------------------------------------------------------------------------------------
#
#What to check for:
#- IN REQUEST URL
#   - URL (http(s), ftp(s), file)
#   - IP - "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}"
#   - Include functions (include(s), include_once, etc)
#
SecRule REQUEST_URI|ARGS|REQUEST_BODY "@rx (?i)(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})" "id:100005,phase:1,log,auditlog,deny,status:403,msg:'RFI'"



# SERVER-SIDE REQUEST FORGERY (SSRF)------------------------------------------------------------------------------------
# wrappers
# /  &frasl;  %2F
# : &#58;  %3A

SecRule REQUEST_URI "@rx (?i)((dict|expect|fd|files*|gopher|https*|imap|jar|proto-schema|ldap|mailto|netdoc|ogg|pop3|[st]*[mf]tp|ssh2*|telnet)(:)(/)*)" "id:100006,phase:1,log,auditlog,deny,status:403,msg:'SSRF wrapper'"

# localhost bypass
SecRule REQUEST_URI_RAW|REQUEST_URI|ARGS "@rx (?i)((.)*(\/\/.+[\/](\#|\@|\?|\\)+)|(\.|\@|\\|:|#|\?|%|\/)*((0x[\dA-F]{8})|\d{10}|(\[(((0{1,4}|1|ffff)*:*)){1,7}\]*)|(((127|[0-3])\.*){1,3}(127|[0-3])*)+(:(22|25|80|443|3128))*(\.|\@|\\|:|#|\?|%|\/)*))" "id:100007,phase:1,log,auditlog,deny,status:403,msg:'SSRF Localhost Bypass'"
SecRule REQUEST_URI "@rx (?i)(((localho)+st)+[^a-z])" "id:100008,phase:1,log,auditlog,deny,status:403,msg:'SSRF Localhost Bypass'"
